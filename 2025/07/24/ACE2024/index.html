<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>小白写给小白的wp-腾讯游戏安全竞赛2024安卓 | Tinia's Blog</title><meta name="author" content="Tinia"><meta name="copyright" content="Tinia"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="0x0 逆向前的准备（本文中引用的代码基于UE4.27） 笔者是第一次接触虚幻引擎相关的逆向，所以这里先速览一下基础知识 先快速看一眼UE5的文档，核心的开发模型应该变化不会太大。 UE5文档速览直接看虚幻引擎术语。这里摘要自认为重要的地方  虚幻引擎术语 对象Object 是虚幻引擎中最基本的类。虚幻引擎中的几乎所有功能都继承自object（或使用其中的部分功能）。 在C++中，UObject">
<meta property="og:type" content="article">
<meta property="og:title" content="小白写给小白的wp-腾讯游戏安全竞赛2024安卓">
<meta property="og:url" content="http://example.com/2025/07/24/ACE2024/index.html">
<meta property="og:site_name" content="Tinia&#39;s Blog">
<meta property="og:description" content="0x0 逆向前的准备（本文中引用的代码基于UE4.27） 笔者是第一次接触虚幻引擎相关的逆向，所以这里先速览一下基础知识 先快速看一眼UE5的文档，核心的开发模型应该变化不会太大。 UE5文档速览直接看虚幻引擎术语。这里摘要自认为重要的地方  虚幻引擎术语 对象Object 是虚幻引擎中最基本的类。虚幻引擎中的几乎所有功能都继承自object（或使用其中的部分功能）。 在C++中，UObject">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-07-24T08:03:17.347Z">
<meta property="article:modified_time" content="2025-07-24T11:10:02.914Z">
<meta property="article:author" content="Tinia">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "小白写给小白的wp-腾讯游戏安全竞赛2024安卓",
  "url": "http://example.com/2025/07/24/ACE2024/",
  "image": "http://example.com/img/butterfly-icon.png",
  "datePublished": "2025-07-24T08:03:17.347Z",
  "dateModified": "2025-07-24T11:10:02.914Z",
  "author": [
    {
      "@type": "Person",
      "name": "Tinia",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/07/24/ACE2024/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '小白写给小白的wp-腾讯游戏安全竞赛2024安卓',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Tinia's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">小白写给小白的wp-腾讯游戏安全竞赛2024安卓</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">小白写给小白的wp-腾讯游戏安全竞赛2024安卓</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-24T08:03:17.347Z" title="发表于 2025-07-24 16:03:17">2025-07-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-24T11:10:02.914Z" title="更新于 2025-07-24 19:10:02">2025-07-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="0x0-逆向前的准备"><a href="#0x0-逆向前的准备" class="headerlink" title="0x0 逆向前的准备"></a>0x0 逆向前的准备</h1><p>（本文中引用的代码基于UE4.27）</p>
<p>笔者是第一次接触虚幻引擎相关的逆向，所以这里先速览一下基础知识</p>
<p>先快速看一眼UE5的文档，核心的开发模型应该变化不会太大。</p>
<h2 id="UE5文档速览"><a href="#UE5文档速览" class="headerlink" title="UE5文档速览"></a>UE5文档速览</h2><p>直接看<strong>虚幻引擎术语</strong>。这里摘要自认为重要的地方</p>
<blockquote>
<p><strong>虚幻引擎术语</strong></p>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><p><strong>Object</strong> 是虚幻引擎中最基本的类。虚幻引擎中的几乎所有功能都继承自object（或使用其中的部分功能）。</p>
<p>在C++中，<code>UObject</code> 是所有object的基类，可以实施多种功能，例如垃圾回收、用于将变量提供给虚幻编辑器的元数据（<code>UProperty</code>）支持以及用于加载和保存的序列化。</p>
<h2 id="Actor"><a href="#Actor" class="headerlink" title="Actor"></a>Actor</h2><p><strong>Actor</strong> 是可以放到关卡中的任何object，例如摄像机、静态网格体或玩家出生点位置。</p>
<p>在C++中，<code>AActor</code> 是所有Actor的基类。</p>
<h2 id="Pawn"><a href="#Pawn" class="headerlink" title="Pawn"></a><strong>Pawn</strong></h2><p><strong>Pawn</strong> 是Actor的子类，作为游戏内的形象或人像（例如游戏中的角色）。玩家或游戏的AI可以控制Pawn，将其作为非玩家角色（NPC）。</p>
<h2 id="角色"><a href="#角色" class="headerlink" title="角色"></a><strong>角色</strong></h2><p><strong>角色（Character）</strong> 是计划用作玩家角色的Pawn Actor的子类。角色子类包括碰撞设置、双足运动的输入绑定以及用于玩家控制动作的其他代码。</p>
<h2 id="玩家状态"><a href="#玩家状态" class="headerlink" title="玩家状态"></a><strong>玩家状态</strong></h2><p><strong>玩家状态（Player State）</strong> 是游戏参与者在游戏中的状态，例如人类玩家或模拟玩家的机器人。非玩家AI作为游戏世界的一部分而存在，没有玩家状态。</p>
<p>玩家状态可能包含的玩家信息示例包括：</p>
<ul>
<li>名称</li>
<li>当前级别</li>
<li>血量</li>
<li>得分</li>
</ul>
<p>关联的C++类是 <code>PlayerState</code>。</p>
<h2 id="体积"><a href="#体积" class="headerlink" title="体积"></a><strong>体积</strong></h2><p><strong>体积（Volumes）</strong> 是带有边界的3D空间，根据连接到体积的效果，具有不同的使用方法。例如：</p>
<ul>
<li><strong>阻挡体积（Blocking Volumes）</strong> 是可见的，用于阻止Actor通过它们。</li>
<li><strong>施加伤害体积（Pain Causing Volume）</strong> 对与其重叠的任何Actor造成持续伤害。</li>
<li><strong>触发器体积（Trigger Volumes）</strong> 的编程方式为，在Actor进入或退出体积时触发事件</li>
</ul>
</blockquote>
<p><strong>Actor</strong>的文档</p>
<blockquote>
<p><strong>Actor</strong></p>
<h3 id="玩家出生点"><a href="#玩家出生点" class="headerlink" title="玩家出生点"></a><strong>玩家出生点</strong></h3><p><strong>玩家出生点（Player Start）</strong> 是放置在关卡中的一种Actor，用于指定在玩家开始关卡时，玩家角色在何处生成。</p>
<h3 id="阻挡体积"><a href="#阻挡体积" class="headerlink" title="阻挡体积"></a><strong>阻挡体积</strong></h3><p>顾名思义，<strong>阻挡体积（Blocking Volumes）</strong> 用于防止玩家穿过。例如，你可以使用阻挡体积不让玩家从游戏世界的边缘掉落。</p>
</blockquote>
<p>以及<strong>命名约定</strong></p>
<blockquote>
<p><strong>命名约定</strong></p>
<ul>
<li>类型名称以额外的大写字母为前缀，以区别于变量名称。例如，<code>FSkin</code> 是类型名称，<code>Skin</code> 是 <code>FSkin</code> 类型的实例。</li>
<li>模板类以 T 为前缀。</li>
<li>从 <a target="_blank" rel="noopener" href="https://dev.epicgames.com/documentation/en-us/unreal-engine/objects-in-unreal-engine?application_version=5.4">UObject</a> 继承的类以 U 为前缀。</li>
<li>从 <a target="_blank" rel="noopener" href="https://dev.epicgames.com/documentation/en-us/unreal-engine/actors-in-unreal-engine?application_version=5.4">AActor</a> 继承的类以 A 为前缀。</li>
<li>从 <a target="_blank" rel="noopener" href="https://dev.epicgames.com/documentation/en-us/unreal-engine/slate-user-interface-programming-framework-for-unreal-engine?application_version=5.4">SWidget</a> 继承的类以 S 为前缀。</li>
<li>作为抽象接口的类以 I 为前缀。</li>
<li>枚举以 E 为前缀。</li>
<li>布尔变量必须以 b 为前缀。</li>
<li>大多数其他类都以 F 为前缀</li>
</ul>
</blockquote>
<p>也就是说游戏里所有的实体都是一个<code>actor</code>。想实现修改首先需要找到对应的actor。那么该如何找到呢？</p>
<h2 id="UE4内部实现"><a href="#UE4内部实现" class="headerlink" title="UE4内部实现"></a>UE4内部实现</h2><blockquote>
<p>（以下基于UE4.27）</p>
</blockquote>
<p>先编译一下UE4的源码，方便后续分析：<a target="_blank" rel="noopener" href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/building-unreal-engine-from-source?application_version=4.27">https://dev.epicgames.com/documentation/zh-cn/unreal-engine/building-unreal-engine-from-source?application_version=4.27</a></p>
<p>官方文档中给出了将源码导入到visual studio的方法。导入后可以更直观的分析类之间的关系和<strong>计算类成员变量的偏移</strong>。注意要把平台设置到android</p>
<p>这里需要先了解一点虚幻引擎的内部实现。UE4的大体框架如下：</p>
<p><img src="/2025/07/24/ACE2024/image-20250507200957121-1753344110067-21.png" alt="image-20250507200957121"></p>
<p>（图片来源：<a target="_blank" rel="noopener" href="https://renyili.org/post/game_cheat2/%EF%BC%89">https://renyili.org/post/game_cheat2/）</a></p>
<p>其中：</p>
<ul>
<li><code>UGameInstance</code>类，对应UE中最顶层的Game概念，在游戏创建时产生，直到游戏实例关闭时才被销毁，它通过<strong>WorldContext</strong>（图中未表现）管理着游戏中的多个<strong>世界（World）</strong>。一般来说，全局唯一。</li>
<li><code>UWorld</code>类，对应引擎中的<strong>世界(World)概念，它包含了游戏中的所有关卡（Level）</strong>。它可以处理关卡流送，还能生成（创建）动态Actor。</li>
<li><code>ULevel</code>类，对应引擎中的**关卡(Level)**概念，它是用户定义的游戏区域。关卡包含了玩家能看到的所有内容，例如几何体、Pawn和Actor。</li>
<li><code>AActor</code>类，对应<strong>Actor</strong>概念，所有可以放入<strong>关卡</strong>的对象都是 <strong>Actor</strong>，无论是实体还是非实体，比如摄像机、静态网格体。</li>
<li><code>USceneComponent</code>类，<code>AActor</code>本身不包含位置信息，UE将其封装到了<code>UScaneComponent</code>中，作为<code>AActor</code>的<code>RootComponent</code>成员。</li>
<li><code>APawn</code>类，对应<strong>Pawn</strong>概念，它是Actor的子类，可以与玩家发生交互的称之为Pawn，它可以由玩家操控，也可以由游戏AI控制并以非玩家角色（NPC）的形式存在于游戏中。</li>
<li><code>AShooterCharacter</code>类，该类是ShooterGame游戏中的类，非UE引擎中定义的类。该类对应**角色(Character)**概念，它是<code>ACharacter</code>的子类（图中未展示），而<code>ACharacter</code>又是<code>APawn</code>的子类。<code>ACharacter</code>旨在表示所有的人形的带骨骼的Pawn。</li>
<li><code>APlayerController</code>类，对应**玩家控制器（Player Controller）**概念，它会获取游戏中玩家的输入信息，然后转换为交互效果，每个游戏中至少有一个玩家控制器。玩家控制器通常会控制一个Pawn或Character，将其作为玩家在游戏中的化身。</li>
<li><code>APlayerState</code>类，存储Player的一些状态信息。</li>
</ul>
<p>想要做修改，需要先找到对应的Actor。可以通过<code>UWorld→ULevel PersistentLevel→TArray&lt;AActor*&gt; Actors</code>来遍历所有Actor。UE4中实际是用一个全局变量<code>UWorldProxy GWorld;</code> 来指向当前<code>World</code>。其内部结构：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UWorldProxy</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	UWorld* World;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也就是说，逆向过程中只要确定了<code>GWorld</code>的地址就可以找到所有<code>Actor</code> 。只需要再计算一下偏移：</p>
<p>首先直接<code>*GWorld</code>，获取到<code>UWorld</code> 对象</p>
<p>UWorld简化结构如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UWorld</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Level* PersistentLevel;<span class="comment">//[Offset: 0x30, Size: 0x8]</span></span><br><span class="line">	NetDriver* NetDriver;<span class="comment">//[Offset: 0x38, Size: 0x8]</span></span><br><span class="line">	LineBatchComponent* LineBatcher;<span class="comment">//[Offset: 0x40, Size: 0x8]</span></span><br><span class="line">	LineBatchComponent* PersistentLineBatcher;<span class="comment">//[Offset: 0x48, Size: 0x8]</span></span><br><span class="line">	LineBatchComponent* ForegroundLineBatcher;<span class="comment">//[Offset: 0x50, Size: 0x8]</span></span><br><span class="line">	GameNetworkManager* NetworkManager;<span class="comment">//[Offset: 0x58, Size: 0x8]</span></span><br><span class="line">	PhysicsCollisionHandler* PhysicsCollisionHandler;<span class="comment">//[Offset: 0x60, Size: 0x8]</span></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么<code>*(UWorld+0x30)</code>即可获取到<code>ULevel* PersistentLevel</code> </p>
<p><code>ULevel</code>实现如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ULevel</span> : <span class="keyword">public</span> UObject, <span class="keyword">public</span> IInterface_AssetUserData, <span class="keyword">public</span> ITextureStreamingContainer, <span class="keyword">public</span> IEditorPathObjectInterface</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	FURL					URL;</span><br><span class="line">	TArray&lt;TObjectPtr&lt;AActor&gt;&gt; Actors;    <span class="comment">//0x98</span></span><br><span class="line">	TArray&lt;TObjectPtr&lt;AActor&gt;&gt; ActorsForGC;</span><br><span class="line">	<span class="function">ENGINE_API <span class="type">bool</span> <span class="title">TryAddActorToList</span><span class="params">(AActor* InActor, <span class="type">bool</span> bAddUnique)</span></span>;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> InElementType, <span class="keyword">typename</span> InAllocatorType&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TArray</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	ElementAllocatorType AllocatorInstance;</span><br><span class="line">	SizeType             ArrayNum;</span><br><span class="line">	SizeType             ArrayMax;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么到这里我们可以通过<code>ULevel+0x98</code>来获取<code>Actors</code>。即**<code>Actors = *(*GWorld+0x30)+0x98</code>**</p>
<p>获取到所有<code>Actor</code>后如何判断哪个是我们想要的呢？可以通过<code>FName</code>来判断。</p>
<p><code>FName</code>是<code>UObject</code>的成员变量，用来保存tag的逻辑名称。可以通过观察<code>actor</code>的逻辑名称来判断是不是我们想控制的<code>actor</code>。</p>
<p><code>UObject</code>的成员变量如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UObject</span> : <span class="keyword">public</span> UObjectBaseUtility</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">enum class</span> <span class="title class_">ENetFields_Private</span></span><br><span class="line">	&#123;</span><br><span class="line">		NETFIELD_REP_START = <span class="number">0</span>,</span><br><span class="line">		NETFIELD_REP_END = <span class="number">-1</span></span><br><span class="line">	&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">FAssetRegistryTag</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/** Enum specifying the type of this tag */</span></span><br><span class="line">		<span class="keyword">enum</span> <span class="title class_">ETagType</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/** This tag should not be shown in the UI */</span></span><br><span class="line">			TT_Hidden,</span><br><span class="line">			<span class="comment">/** This tag should be shown, and sorted alphabetically in the UI */</span></span><br><span class="line">			TT_Alphabetical,</span><br><span class="line">			<span class="comment">/** This tag should be shown, and is a number */</span></span><br><span class="line">			TT_Numerical,</span><br><span class="line">			<span class="comment">/** This tag should be shown, and is an &quot;x&quot; delimited list of dimensions */</span> </span><br><span class="line">			TT_Dimensional,</span><br><span class="line">			<span class="comment">/** This tag should be shown, and is a timestamp formatted via FDateTime::ToString */</span></span><br><span class="line">			TT_Chronological,</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/** Flags controlling how this tag should be shown in the UI */</span></span><br><span class="line">		<span class="keyword">enum</span> <span class="title class_">ETagDisplay</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/** No special display */</span></span><br><span class="line">			TD_None = <span class="number">0</span>,</span><br><span class="line">			<span class="comment">/** For TT_Chronological, include the date */</span></span><br><span class="line">			TD_Date = <span class="number">1</span>&lt;&lt;<span class="number">0</span>,</span><br><span class="line">			<span class="comment">/** For TT_Chronological, include the time */</span></span><br><span class="line">			TD_Time = <span class="number">1</span>&lt;&lt;<span class="number">1</span>,</span><br><span class="line">			<span class="comment">/** For TT_Chronological, specifies that the timestamp should be displayed using the invariant timezone (typically for timestamps that are already in local time) */</span></span><br><span class="line">			TD_InvariantTz = <span class="number">1</span>&lt;&lt;<span class="number">2</span>,</span><br><span class="line">			<span class="comment">/** For TT_Numerical, specifies that the number is a value in bytes that should be displayed using FText::AsMemory */</span></span><br><span class="line">			TD_Memory = <span class="number">1</span>&lt;&lt;<span class="number">3</span>,</span><br><span class="line">		&#125;;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">/** Logical name of this tag */</span></span><br><span class="line">		FName Name;		<span class="comment">//0x30</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">/** Value string for this tag, may represent any data type */</span></span><br><span class="line">		FString Value;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/** Broad description of kind of data represented in Value */</span></span><br><span class="line">		ETagType Type = TT_Alphabetical;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/** Flags describing more detail for displaying in the UI */</span></span><br><span class="line">		uint32 DisplayFlags = TD_None;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UObject是几乎所有其他类的基类。所以在其他类中，FName的偏移统一是<code>0x30</code></p>
<p>实际上<code>FName</code>并不保存字符串，只是保存了字符串在内存池中的位置：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FName</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">/** Index into the Names array (used to find String portion of the string/number pair used for comparison) */</span></span><br><span class="line">	FNameEntryId	ComparisonIndex;		<span class="comment">//0x0</span></span><br><span class="line">	<span class="comment">/** Number portion of the string/number pair (stored internally as 1 more than actual, so zero&#x27;d memory will be the default, no-instance case) */</span></span><br><span class="line">	uint32			Number;					<span class="comment">//0x4</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment">/** Index into the Names array (used to find String portion of the string/number pair used for display) */</span></span><br><span class="line">	FNameEntryId	DisplayIndex;			<span class="comment">//0x8</span></span><br><span class="line">&#125;			</span><br></pre></td></tr></table></figure>

<p>实际的字符串内容由<code>FNameEntry</code>来保存</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">FNameEntry</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	FNameEntryHeader Header;</span><br><span class="line">	<span class="keyword">union</span></span><br><span class="line">	&#123;</span><br><span class="line">		ANSICHAR			AnsiName[NAME_SIZE];  <span class="comment">//NAME_SIZE = 1024</span></span><br><span class="line">		WIDECHAR			WideName[NAME_SIZE];</span><br><span class="line">		FNumberedData		NumberedName;</span><br><span class="line">	&#125;;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所有的<code>FNameEntry</code>的指针全都保存在<code>FNameEntryAllocator</code> 管理的<code>Blocks</code>中：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FNameEntryAllocator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">enum</span> &#123; Stride = <span class="built_in">alignof</span>(FNameEntry) &#125;;</span><br><span class="line">	<span class="keyword">enum</span> &#123; BlockSizeBytes = Stride * FNameBlockOffsets &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">mutable</span> FRWLock Lock;                 <span class="comment">//android下是pthread_rwlock_t </span></span><br><span class="line">	uint32 CurrentBlock = <span class="number">0</span>;              <span class="comment">//0x38 当前块号</span></span><br><span class="line">	uint32 CurrentByteCursor = <span class="number">0</span>;         <span class="comment">//0x3C当前块内偏移</span></span><br><span class="line">	uint8* Blocks[FNameMaxBlocks] = &#123;&#125;;   <span class="comment">//0x40 FNameMaxBlocks=8192，最大内存块数。每个内存块中有若干FNameEntry指针</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里<code>FRWLock</code>在<code>android</code>下实际是<code>pthread_rwlock_t</code> ，32位下是0x28，64位下是0x38</p>
<p>而<code>FNameEntryAllocator</code>封装在<code>FNamePool</code>中。实际上是通过一个全局变量<code>FNamePool GName</code> 来管理。<code>GName</code>保存在<code>alignas(FNamePool) static uint8 NamePoolData[sizeof(FNamePool)];</code>。也就是说，找到<code>GWorld</code>后可以找到所有<code>Actor</code>以及<code>Actor</code>的<code>FName</code>，找到<code>GName</code>后就能找到所有的<code>FNameEntry</code>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FNamePool</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">enum</span> &#123; MaxENames = <span class="number">512</span> &#125;;</span><br><span class="line"></span><br><span class="line">	FNameEntryAllocator Entries;            <span class="comment">//0x0</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">alignas</span>(PLATFORM_CACHE_LINE_SIZE) FNameEntryId ENameToEntry[(uint32)EName::MaxHardcodedNameIndex] = &#123;&#125;;</span><br><span class="line">	uint32 LargestEnameUnstableId;</span><br><span class="line">	TMap&lt;FNameEntryId, EName, TInlineSetAllocator&lt;MaxENames&gt;&gt; EntryToEName;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>那么如何将<code>FName</code>和<code>FNameEntry</code>一一对应呢？观察<code>FName</code>中的方法<code>GetComparisonNameEntry</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FName通过该方法来获取FNameEntry</span></span><br><span class="line"><span class="function"><span class="type">const</span> FNameEntry* <span class="title">FName::GetComparisonNameEntry</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">ResolveEntryRecursive</span>(<span class="built_in">GetComparisonIndexInternal</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>GetComparisonNameEntry</code>调用的<code>GetComparisonIndexInternal</code>直接返回<code>FName</code>的成员变量<code>FNameEntryId ComparisonIndex</code>。其中<code>FNameEntryId</code> 的成员变量为<code>uint32 Value;</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">FORCEINLINE FNameEntryId <span class="title">GetComparisonIndexInternal</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> ComparisonIndex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FNameEntryId</span></span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	uint32 Value;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>继续跟进<code>ResolveEntryRecursive</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> FNameEntry* <span class="title">FName::ResolveEntryRecursive</span><span class="params">(FNameEntryId LookupId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">const</span> FNameEntry* Entry = <span class="built_in">ResolveEntry</span>(LookupId);</span><br><span class="line">	<span class="keyword">return</span> Entry;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>继续跟进<code>ResolveEntry</code>。这里它调用<code>Resolve</code>的过程做了一次类型转换，将<code>FNameEntryId</code>转换成了<code>FNameEntryHandle</code>。将<code>uint32 Value</code> 的高16位和低16位分别赋给了<code>Block</code>和<code>Offset</code> ，然后根据这两个值从<code>Blocks</code>中获取到对应的<code>FNameEntry</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> FNameEntry* <span class="title">FName::ResolveEntry</span><span class="params">(FNameEntryId LookupId)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;<span class="built_in">GetNamePool</span>().<span class="built_in">Resolve</span>(LookupId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">FNameEntryHandle</span>(FNameEntryId Id)</span><br><span class="line">		: <span class="built_in">Block</span>(Id.<span class="built_in">ToUnstableInt</span>() &gt;&gt; FNameBlockOffsetBits)    <span class="comment">//FNameBlockOffsetBits = 16;</span></span><br><span class="line">		, <span class="built_in">Offset</span>(Id.<span class="built_in">ToUnstableInt</span>() &amp; (FNameBlockOffsets - <span class="number">1</span>)) <span class="comment">//FNameBlockOffsets = 1 &lt;&lt; FNameBlockOffsetBits;</span></span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="function">FNameEntry&amp; <span class="title">Resolve</span><span class="params">(FNameEntryHandle Handle)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// Lock not needed</span></span><br><span class="line">	<span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;FNameEntry*&gt;(Blocks[Handle.Block] + Stride * Handle.Offset); <span class="comment">//Stride = alignof(FNameEntry) </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也就是说，当我们获取到了<code>Actor</code>的<code>FName</code>后，就可以根据它的<code>ComparisonIndex</code>来找到相应的<code>FNameEntry</code>来找到对应的字符串。</p>
<h1 id="0x1-开始逆向"><a href="#0x1-开始逆向" class="headerlink" title="0x1 开始逆向"></a>0x1 开始逆向</h1><p>确定UE4版本，定位<code>GUObjectArray GWorld GName</code></p>
<p>ida打开libUE4，搜索可以看到版本是4.27</p>


<h3 id="GUObjectArray"><a href="#GUObjectArray" class="headerlink" title="GUObjectArray"></a>GUObjectArray</h3><p>接下来定位<code>GUObjectArray</code>  。在源码中可以发现以下模式：</p>
<p><img src="/2025/07/24/ACE2024/image-20250507201039205-1753344135939-23.png" alt="image-20250507201039205"></p>
<p>跟踪调用发现：</p>
<p><img src="/2025/07/24/ACE2024/image-20250507201051746-1753344140581-25.png" alt="image-20250507201051746"></p>
<p>所以在ida中搜索到<code>Max UObject count is invalid. It must be a number that is greater than 0.</code> 所在的函数的第一个参数就是<code>GUObjectArray</code> 。最终偏移是<code>0xB1B5F98</code></p>
<h3 id="GName"><a href="#GName" class="headerlink" title="GName"></a>GName</h3><p>ida搜索<code>ByteProperty</code> ，查找引用可以找到GName的初始化函数</p>
<p><img src="/2025/07/24/ACE2024/image-20250507201101765-1753344142445-27.png" alt="image-20250507201101765"></p>
<p>查找引用。调用这个函数传的参数就是GName。偏移是<code>0xB171CC0</code></p>
<p><img src="/2025/07/24/ACE2024/image-20250507201111069-1753344144467-29.png" alt="image-20250507201111069"></p>
<h3 id="GWorld"><a href="#GWorld" class="headerlink" title="GWorld"></a>GWorld</h3><p>观察<code>world.cpp</code>源码，可以发现以下模式</p>
<p><img src="/2025/07/24/ACE2024/image-20250507201122230-1753344147337-31.png" alt="image-20250507201122230"></p>
<p><img src="/2025/07/24/ACE2024/image-20250507201127531-1753344148575-33.png" alt="image-20250507201127531"></p>
<p><img src="/2025/07/24/ACE2024/image-20250507201135969-1753344150546-35.png" alt="image-20250507201135969"></p>
<p>ida搜索<code>SeamlessTravel FlushLevelStreaming</code>，找到</p>
<p><img src="/2025/07/24/ACE2024/image-20250507201144385-1753344152741-37.png" alt="image-20250507201144385"></p>
<p>往上翻</p>
<p><img src="/2025/07/24/ACE2024/image-20250507201152063-1753344153934-39.png" alt="image-20250507201152063"></p>
<p>再往上翻</p>
<p><img src="/2025/07/24/ACE2024/image-20250507201158821-1753344155468-41.png" alt="image-20250507201158821"></p>
<p>所以GWorld的地址是<code>0xB32D8A8</code></p>
<p>有了这三个的地址就可以确定到需要的actor了。接下来用<code>ue4dumper</code>来dump出sdk方便后续操作。</p>
<p>下载ue4dumper上传到手机上：<a target="_blank" rel="noopener" href="https://github.com/kp7742/UE4Dumper/tree/master">https://github.com/kp7742/UE4Dumper/tree/master</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dump sdk:</span></span><br><span class="line">./ue4dumper64 --package com.tencent.ace.match2024  --newue+ --sdkw  --gworld 0xB32D8A8 --gname 0xB171CC0 --output /data/local/tmp/dumpSDK</span><br><span class="line"></span><br><span class="line"><span class="comment"># dump objs: </span></span><br><span class="line">./ue4dumper64 --package com.tencent.ace.match2024  --newue+ --objs  --gname 0xB171CC0 --guobj 0xB1B5F98 --output /data/local/tmp/dumpSDK</span><br><span class="line"></span><br><span class="line"><span class="comment"># dump actors</span></span><br><span class="line">./ue4dumper64 --package com.tencent.ace.match2024  --newue+ --actors  --gworld 0xB32D8A8 --gname 0xB171CC0 &gt; /data/local/tmp/dumpSDK/actors.txt</span><br></pre></td></tr></table></figure>



<h1 id="0x2-解题"><a href="#0x2-解题" class="headerlink" title="0x2 解题"></a>0x2 解题</h1><h3 id="section0"><a href="#section0" class="headerlink" title="section0"></a>section0</h3><p>先把偏移和找actor相关的方法写了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UE4Reverse</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">GNameOffset, GWorldOffset</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GNameOffset</span> = <span class="title class_">GNameOffset</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GWorldOffset</span> = <span class="title class_">GWorldOffset</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">moduleName</span> = <span class="string">&quot;libUE4.so&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">moduleBase</span> = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="variable language_">this</span>.<span class="property">moduleName</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">moduleBase</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[!]  模块 <span class="subst">$&#123;<span class="variable language_">this</span>.moduleName&#125;</span> 未加载`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GWorld</span> = <span class="variable language_">this</span>.<span class="property">moduleBase</span>.<span class="title function_">add</span>(<span class="title class_">GWorldOffset</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;moduleBase: &quot;</span> + <span class="variable language_">this</span>.<span class="property">moduleBase</span>.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;GWorld Offset: &quot;</span> + <span class="title class_">GWorldOffset</span>.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;GWorld: &quot;</span> + <span class="variable language_">this</span>.<span class="property">GWorld</span>.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GName</span> = <span class="variable language_">this</span>.<span class="property">moduleBase</span>.<span class="title function_">add</span>(<span class="title class_">GNameOffset</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">FNameEntryAllocator</span> = <span class="variable language_">this</span>.<span class="property">GName</span>.<span class="title function_">add</span>(<span class="number">0x30</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Blocks</span> = <span class="variable language_">this</span>.<span class="property">FNameEntryAllocator</span>.<span class="title function_">add</span>(<span class="number">0x10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GLevel</span> = <span class="variable language_">this</span>.<span class="property">GWorld</span>.<span class="title function_">add</span>(<span class="number">0x30</span>).<span class="title function_">readPointer</span>(); <span class="comment">//UWorld to Level</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Actors</span> = <span class="variable language_">this</span>.<span class="property">GLevel</span>.<span class="title function_">add</span>(<span class="number">0x98</span>).<span class="title function_">readPointer</span>(); <span class="comment">//ULevel -&gt; Actors</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ActorNum</span> = <span class="variable language_">this</span>.<span class="property">GLevel</span>.<span class="title function_">add</span>(<span class="number">0x98</span>).<span class="title function_">add</span>(<span class="number">0x8</span>).<span class="title function_">readU32</span>(); <span class="comment">//ULevel -&gt; Num</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getNameById</span>(<span class="params">ComparisonIndex</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">BlockId</span> = <span class="title class_">ComparisonIndex</span> &gt;&gt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Offset</span> = <span class="title class_">ComparisonIndex</span> &amp; <span class="number">65535</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> currentBlock = <span class="variable language_">this</span>.<span class="property">Blocks</span>.<span class="title function_">add</span>(<span class="number">8</span> * <span class="title class_">BlockId</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">FNameEntry</span> = currentBlock.<span class="title function_">add</span>(<span class="number">2</span> * <span class="title class_">Offset</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">FNameEntryHeader</span> = <span class="title class_">FNameEntry</span>.<span class="title function_">readU16</span>();</span><br><span class="line">        <span class="keyword">var</span> str_length = <span class="title class_">FNameEntryHeader</span> &gt;&gt; <span class="number">6</span>; <span class="comment">// 计算字符串长度</span></span><br><span class="line">        <span class="keyword">var</span> wide = <span class="title class_">FNameEntryHeader</span> &amp; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> str_addr = <span class="title class_">FNameEntry</span>.<span class="title function_">add</span>(<span class="number">0x2</span>);</span><br><span class="line">        <span class="keyword">if</span> (wide) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;wide_string&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (str_length &gt; <span class="number">0</span> &amp;&amp; str_length &lt; <span class="number">250</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> str = str_addr.<span class="title function_">readUtf8String</span>(str_length);</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">            <span class="number">0xadf07c0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;None&quot;</span>; <span class="comment">// 长度不合理，返回 &quot;None&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getActorByName</span>(<span class="params">actorName</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">ActorNum</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Actor</span> = <span class="variable language_">this</span>.<span class="property">Actors</span>.<span class="title function_">add</span>(i * <span class="number">8</span>).<span class="title function_">readPointer</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">ComparisonIndex</span> = <span class="title class_">Actor</span>.<span class="title function_">add</span>(<span class="number">0x18</span>).<span class="title function_">readU32</span>(); <span class="comment">//Actor -&gt; ComparisonIndex</span></span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Name</span> = <span class="variable language_">this</span>.<span class="title function_">getNameById</span>(<span class="title class_">ComparisonIndex</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">Name</span> == actorName) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;return Actor &quot;</span> + actorName);</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Actor</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;can&#x27;t find Actor:&quot;</span> + actorName);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;None&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getNameByActor</span>(<span class="params">actor</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">ComparisonIndex</span> = actor.<span class="title function_">add</span>(<span class="number">0x18</span>).<span class="title function_">readU32</span>(); <span class="comment">//Actor -&gt; ComparisonIndex</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Name</span> = <span class="variable language_">this</span>.<span class="title function_">getNameById</span>(<span class="title class_">ComparisonIndex</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">printAllActorName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">ActorNum</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Actor</span> = <span class="variable language_">this</span>.<span class="property">Actors</span>.<span class="title function_">add</span>(i * <span class="number">8</span>).<span class="title function_">readPointer</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">ComparisonIndex</span> = <span class="title class_">Actor</span>.<span class="title function_">add</span>(<span class="number">0x18</span>).<span class="title function_">readU32</span>(); <span class="comment">//Actor -&gt; ComparisonIndex</span></span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Name</span> = <span class="variable language_">this</span>.<span class="title function_">getNameById</span>(<span class="title class_">ComparisonIndex</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[!] actor <span class="subst">$&#123;i&#125;</span> Name: <span class="subst">$&#123;Name&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">forAllActor</span>(<span class="params">func</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">ActorNum</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Actor</span> = <span class="variable language_">this</span>.<span class="property">Actors</span>.<span class="title function_">add</span>(i * <span class="number">8</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">            <span class="title function_">func</span>(<span class="title class_">Actor</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>首先是出门。碰到墙就会重置到原点。推测可能是撞墙后扣血了？</p>
<p>这里想到的方法：</p>
<ul>
<li>改扣血函数</li>
<li>改血量</li>
<li>改重生地点</li>
<li>改碰撞检测</li>
</ul>
<p>这里主要尝试了改扣血函数和改血量。</p>
<h4 id="改血量："><a href="#改血量：" class="headerlink" title="改血量："></a>改血量：</h4><p>观察dump出的sdk中，<code>FirstPersonCharacter_C</code>存在变量<code>float 生命值;//[Offset: 0x510, Size: 0x4]</code>。用frida直接将其改成一个比较大的数字即可。</p>
<h4 id="扣血函数："><a href="#扣血函数：" class="headerlink" title="扣血函数："></a>扣血函数：</h4><p>观察dump出的sdk可以看到<code>FirstPersonCharacter_C</code>有一个方法<code>void ReceiveHit(...);// 0x5e93094</code></p>
<p>跟进可以看到它调用了虚表中偏移为0x8b0的函数</p>
<p><img src="/2025/07/24/ACE2024/image-20250527200435259-1753344159221-43.png" alt="image-20250527200435259"></p>
<p>用frida来dump出虚表的地址是<code>0xa86e1f0</code>函数的地址是<code>0x5e843d4</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ue4Reverse = <span class="keyword">new</span> <span class="title class_">UE4Reverse</span>(<span class="number">0xb171cc0</span>, <span class="number">0xb32d8a8</span>);</span><br><span class="line"><span class="keyword">const</span> user = ue4Reverse.<span class="title function_">getActorByName</span>(<span class="string">&quot;FirstPersonCharacter_C&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> table = user.<span class="title function_">readPointer</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;table addr:&quot;</span> + (table - ue4Reverse.<span class="property">moduleBase</span>).<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;receive hit addr:&quot;</span> + (table.<span class="title function_">add</span>(<span class="number">0x8b0</span>).<span class="title function_">readPointer</span>() - ue4Reverse.<span class="property">moduleBase</span>).<span class="title function_">toString</span>(<span class="number">16</span>));</span><br></pre></td></tr></table></figure>

<p>跟进可以看到</p>
<p><img src="/2025/07/24/ACE2024/image-20250527201221157-1753344165008-45.png" alt="image-20250527201221157"></p>
<p><img src="/2025/07/24/ACE2024/image-20250527201337837-1753344169205-47.png" alt="image-20250527201337837"></p>
<p>把扣血改掉即可。</p>
<h3 id="section1"><a href="#section1" class="headerlink" title="section1"></a>section1</h3><p>关于瞬移（主要用于飞到天上看flag）：</p>
<ul>
<li>尝试调用<code>AddInputVector</code>，失败</li>
<li>尝试调用<code>CharacterMovementComponent.addForce</code> 失败</li>
<li>尝试调用<code>Actor.K2_SetActorLocation</code>，成功</li>
</ul>
<p>测试过程中推测<code>K2_SetActorLocation</code>本质上是将角色平移到对应的坐标。如果两个坐标的连线上有障碍物的话会被拦截。</p>
<p>隐藏的flag：</p>
<ul>
<li>对所有<code>actor</code>的<code>rootComponent</code>调用<code>SetVisibility(1,1)</code>，成功</li>
<li>疑问：再次调用<code>SetVisibility(0,0)</code>，只是变成了黑色，物块依旧可见</li>
</ul>
<p>得到第一段flag：8939</p>
<h3 id="section2"><a href="#section2" class="headerlink" title="section2"></a>section2</h3><p>让物块变得不可穿透：</p>
<p>主要试了以下几种方案：</p>
<ul>
<li><p>对所有<code>actor</code>调用<code>actor -&gt; setActorEnableCollision</code> 没用</p>
</li>
<li><p>对所有<code>actor</code>的<code>rootComponent</code>调用<code>PrimitiveComponent -&gt; setSimulatePhysics</code> 。开启后人动不了了。关闭后会出现很奇怪的问题。</p>
</li>
<li><p>对所有<code>actor</code>的<code>rootComponent</code>调用<code>PrimitiveComponent -&gt; SetCollisionEnabled</code> 开启后人动不了了。关闭后出现了奇怪的问题。</p>
</li>
<li><p>对所有名字里带<code>cube</code>的<code>actor</code>调用<code>actor</code> -&gt; <code>setActorEnableCollision</code> 和 <code>PrimitiveComponent -&gt; setSimulatePhysics</code> 也不行</p>
</li>
<li><p>对所有名字里带<code>cube</code>的<code>actor</code>调用<code>PrimitiveComponent -&gt; SetCollisionEnabled</code>，成功。撞击三个箱子后天上出现flag</p>
</li>
</ul>
<p>得到第二段flag：008</p>
<h3 id="section3"><a href="#section3" class="headerlink" title="section3"></a>section3</h3><p>提示是藏在小球所在的类里面。</p>
<p>那么第一个问题是如何找到小球所在的类。我这里用的方法是站在小球前面，然后计算了所有actor和我的距离。离我最近的actor就是小球。</p>
<p>最终定位小球的名字actor，对应的类是MyActor</p>
<p>sdk里找到：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class: MyActor.Actor.<span class="function">Object</span></span><br><span class="line"><span class="function">	<span class="type">bool</span> <span class="title">getlastflag</span><span class="params">()</span></span>;<span class="comment">// 0x6a91fec</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>跟进看到这里调用了<code>libplay.so</code>中的<code>get_last_flag</code>方法。</p>
<p><img src="/2025/07/24/ACE2024/image-20250402213945585-1753344172675-49.png" alt="image-20250402213945585"></p>
<p>继续跟进，可以看到这里用了br混淆，导致ida没法正确识别控制流。</p>
<p><img src="/2025/07/24/ACE2024/image-20250527163119996-1753344174458-51.png" alt="image-20250527163119996"></p>
<p>其实这段代码不长，直接把汇编扔给deepseek就能还原，但本着学习的态度尝试一下去混淆。</p>
<h4 id="去混淆思路："><a href="#去混淆思路：" class="headerlink" title="去混淆思路："></a>去混淆思路：</h4><p>先unidbg trace一下，观察一下模式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[libplay.so 0x013b8] [5f0113eb] 0x120013b8: <span class="string">&quot;cmp x10, x19&quot;</span> x19=0x12 =&gt; nzcv: N=1, Z=0, C=0, V=0 x10=0x5</span><br><span class="line">[libplay.so 0x013bc] [8f020c8b] 0x120013bc: <span class="string">&quot;add x15, x20, x12&quot;</span> x20=0x12358000 x12=0x3 =&gt; x15=0x12358003</span><br><span class="line">[libplay.so 0x013c0] [eb279f1a] 0x120013c0: <span class="string">&quot;cset w11, lo&quot;</span> nzcv: N=1, Z=0, C=0, V=0 =&gt; w11=0x1</span><br><span class="line">[libplay.so 0x013c4] [10023691] 0x120013c4: <span class="string">&quot;add x16, x16, #0xd80&quot;</span> x16=0x12003000 =&gt; x16=0x12003d80</span><br><span class="line">[libplay.so 0x013c8] [ef054039] 0x120013c8: <span class="string">&quot;ldrb w15, [x15, #1]&quot;</span> x15=0x12358003 =&gt; w15=0x38</span><br><span class="line">[libplay.so 0x013cc] [105a6bf8] 0x120013cc: <span class="string">&quot;ldr x16, [x16, w11, uxtw #3]&quot;</span> x16=0x12003d80 w11=0x1 =&gt; x16=0x12001354</span><br><span class="line">[libplay.so 0x013d0] [ce210f2a] 0x120013d0: <span class="string">&quot;orr w14, w14, w15, lsl #8&quot;</span> w14=0x740000 w15=0x38 =&gt; w14=0x743800</span><br><span class="line">[libplay.so 0x013d4] [00021fd6] 0x120013d4: <span class="string">&quot;br x16&quot;</span> x16=0x12001354</span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[libplay.so 0x01438] [ea279f1a] 0x12001438: <span class="string">&quot;cset w10, lo&quot;</span> nzcv: N=1, Z=0, C=0, V=0 =&gt; w10=0x1</span><br><span class="line">[libplay.so 0x0143c] [2a596af8] 0x1200143c: <span class="string">&quot;ldr x10, [x9, w10, uxtw #3]&quot;</span> x9=0x12003d60 w10=0x1 =&gt; x10=0x12001314</span><br><span class="line">[libplay.so 0x01440] [40011fd6] 0x12001440: <span class="string">&quot;br x10&quot;</span> x10=0x12001314</span><br></pre></td></tr></table></figure>

<p>主要就是这一种模式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cset reg0, flag</span><br><span class="line">...</span><br><span class="line">ldr reg1, xxx					</span><br><span class="line">...</span><br><span class="line">br reg1</span><br></pre></td></tr></table></figure>

<p>这里的思路是将ldr向下挪动，移动到br上方，变成</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cset reg0, flag</span><br><span class="line">ins1</span><br><span class="line">...	</span><br><span class="line">...</span><br><span class="line">ldr reg1, xxx</span><br><span class="line">br reg1</span><br></pre></td></tr></table></figure>

<p>再把ldr替换成<code>b.flag addr</code>，将<code>br</code>替换成<code>br addr</code>，即变成</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cset reg0, flag</span><br><span class="line">ins1</span><br><span class="line">...	</span><br><span class="line">...</span><br><span class="line">b.flag addr1</span><br><span class="line">br addr2</span><br></pre></td></tr></table></figure>

<p>这里使用unidbg来去混淆。具体思路是，通过一个长度为10的队列来保存最近执行的十条指令和上下文。</p>
<p>考虑当遇到br时：</p>
<ul>
<li>向上搜索最近的cset并记录条件</li>
<li>向上搜索距离最近的ldr</li>
<li>读取ldr对应地址处偏移为0和1的两个地址。1为条件跳转目的地，0为无条件跳转目的地。并记录</li>
<li>将ldr操作和br之间的操作向上移动</li>
<li>将ldr根据cset的条件修改成条件跳转</li>
<li>将br跳转地址固定</li>
</ul>
<p>例如，如下指令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[libplay.so 0x013b8] [5f0113eb] 0x120013b8: <span class="string">&quot;cmp x10, x19&quot;</span> x19=0x12 =&gt; nzcv: N=1, Z=0, C=0, V=0 x10=0x5</span><br><span class="line">[libplay.so 0x013bc] [8f020c8b] 0x120013bc: <span class="string">&quot;add x15, x20, x12&quot;</span> x20=0x12358000 x12=0x3 =&gt; x15=0x12358003</span><br><span class="line">[libplay.so 0x013c0] [eb279f1a] 0x120013c0: <span class="string">&quot;cset w11, lo&quot;</span> nzcv: N=1, Z=0, C=0, V=0 =&gt; w11=0x1</span><br><span class="line">[libplay.so 0x013c4] [10023691] 0x120013c4: <span class="string">&quot;add x16, x16, #0xd80&quot;</span> x16=0x12003000 =&gt; x16=0x12003d80</span><br><span class="line">[libplay.so 0x013c8] [ef054039] 0x120013c8: <span class="string">&quot;ldrb w15, [x15, #1]&quot;</span> x15=0x12358003 =&gt; w15=0x38</span><br><span class="line">[libplay.so 0x013cc] [105a6bf8] 0x120013cc: <span class="string">&quot;ldr x16, [x16, w11, uxtw #3]&quot;</span> x16=0x12003d80 w11=0x1 =&gt; x16=0x12001354</span><br><span class="line">[libplay.so 0x013d0] [ce210f2a] 0x120013d0: <span class="string">&quot;orr w14, w14, w15, lsl #8&quot;</span> w14=0x740000 w15=0x38 =&gt; w14=0x743800</span><br><span class="line">[libplay.so 0x013d4] [00021fd6] 0x120013d4: <span class="string">&quot;br x16&quot;</span> x16=0x12001354</span><br></pre></td></tr></table></figure>

<p>最后被修改为</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[libplay.so 0x013b8] [5f0113eb] 0x120013b8: <span class="string">&quot;cmp x10, x19&quot;</span> x19=0x12 =&gt; nzcv: N=1, Z=0, C=0, V=0 x10=0x5</span><br><span class="line">[libplay.so 0x013bc] [8f020c8b] 0x120013bc: <span class="string">&quot;add x15, x20, x12&quot;</span> x20=0x12358000 x12=0x3 =&gt; x15=0x12358003</span><br><span class="line">[libplay.so 0x013c0] [eb279f1a] 0x120013c0: <span class="string">&quot;cset w11, lo&quot;</span> nzcv: N=1, Z=0, C=0, V=0 =&gt; w11=0x1</span><br><span class="line">[libplay.so 0x013c4] [10023691] 0x120013c4: <span class="string">&quot;add x16, x16, #0xd80&quot;</span> x16=0x12003000 =&gt; x16=0x12003d80</span><br><span class="line">[libplay.so 0x013c8] [ef054039] 0x120013c8: <span class="string">&quot;ldrb w15, [x15, #1]&quot;</span> x15=0x12358003 =&gt; w15=0x38</span><br><span class="line">[libplay.so 0x013d0] [ce210f2a] 0x120013d0: <span class="string">&quot;orr w14, w14, w15, lsl #8&quot;</span> w14=0x740000 w15=0x38 =&gt; w14=0x743800</span><br><span class="line">[libplay.so 0x013cc] [105a6bf8] 0x120013cc: <span class="string">&quot;b.lo addr&quot;</span></span><br><span class="line">[libplay.so 0x013d4] [00021fd6] 0x120013d4: <span class="string">&quot;br addr&quot;</span> x16=0x12001354</span><br></pre></td></tr></table></figure>

<p>去混淆后再看，逻辑就清楚多了。这其中还有一些间接跳转可以优化。这里主要就是一个异或加密和一个换表的base64。</p>
<p><img src="/2025/07/24/ACE2024/image-20250527205336719-1753344180661-53.png" alt="image-20250527205336719"></p>
<p>xor的密码：<code>0A 0C 0E 00 51 16 27 38 49 1A 3B 5C 2D 4E 6F FA FC FE</code></p>
<p>base64表：<code>ACE0BDFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz123456789+/</code></p>
<p>target：<code>UT1fc0gIYDArdz80Z0Xem46J</code></p>
<h4 id="解密脚本"><a href="#解密脚本" class="headerlink" title="解密脚本"></a>解密脚本</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line"></span><br><span class="line"># 自定义base64解码</span><br><span class="line">custom_table = <span class="string">&#x27;ACE0BDFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz123456789+/&#x27;</span></span><br><span class="line">custom_dict = &#123;c: i <span class="keyword">for</span> i, c in enumerate(custom_table)&#125;</span><br><span class="line"></span><br><span class="line">def custom_b64decode(s):</span><br><span class="line">    # 处理填充字符</span><br><span class="line">    s += <span class="string">&#x27;=&#x27;</span> * ((<span class="number">4</span> - len(s) % <span class="number">4</span>) % <span class="number">4</span>)</span><br><span class="line">    binary_str = []</span><br><span class="line">    <span class="keyword">for</span> c in s:</span><br><span class="line">        <span class="keyword">if</span> c == <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            binary_str.append(<span class="string">&#x27;000000&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        binary_str.append(f<span class="string">&quot;&#123;custom_dict[c]:06b&#125;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    # 拼接二进制并转换为字节</span><br><span class="line">    bit_stream = <span class="string">&#x27;&#x27;.join(binary_str)</span></span><br><span class="line"><span class="string">    bytes_list = [int(bit_stream[i:i+8], 2) for i in range(0, len(bit_stream), 8) if i+8 &lt;= len(bit_stream)]</span></span><br><span class="line"><span class="string">    return bytes(bytes_list)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 异或解密</span></span><br><span class="line"><span class="string">def xor_decrypt(data, key):</span></span><br><span class="line"><span class="string">    key_len = len(key)</span></span><br><span class="line"><span class="string">    return bytes([data[i] ^ key[i % key_len] for i in range(len(data))])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &quot;__main__&quot;:</span></span><br><span class="line"><span class="string">    encoded_str = &quot;UT1fc0gIYDArdz80Z0Xem46J&quot;</span></span><br><span class="line"><span class="string">    result1 = custom_b64decode(encoded_str)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    key = bytes.fromhex(&quot;0A0C0E0051162738491A3B5C2D4E6FFAFCFE&quot;)</span></span><br><span class="line"><span class="string">    result2 = xor_decrypt(result1, key)</span></span><br><span class="line"><span class="string">    print(&quot;最终结果:&quot;, result2.decode(&quot;utf-8&quot;, errors=&quot;replace&quot;))</span></span><br></pre></td></tr></table></figure>

<p>得到第三段flag：_Anti_Cheat_Expert</p>
<p>至此得到最终flag：8939008_Anti_Cheat_Expert</p>
<h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><h2 id="frida脚本："><a href="#frida脚本：" class="headerlink" title="frida脚本："></a>frida脚本：</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UE4Reverse</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">GNameOffset, GWorldOffset</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GNameOffset</span> = <span class="title class_">GNameOffset</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GWorldOffset</span> = <span class="title class_">GWorldOffset</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">moduleName</span> = <span class="string">&quot;libUE4.so&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">moduleBase</span> = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="variable language_">this</span>.<span class="property">moduleName</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">moduleBase</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[!]  模块 <span class="subst">$&#123;<span class="variable language_">this</span>.moduleName&#125;</span> 未加载`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GWorld</span> = <span class="variable language_">this</span>.<span class="property">moduleBase</span>.<span class="title function_">add</span>(<span class="title class_">GWorldOffset</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;moduleBase: &quot;</span> + <span class="variable language_">this</span>.<span class="property">moduleBase</span>.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;GWorld Offset: &quot;</span> + <span class="title class_">GWorldOffset</span>.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;GWorld: &quot;</span> + <span class="variable language_">this</span>.<span class="property">GWorld</span>.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GName</span> = <span class="variable language_">this</span>.<span class="property">moduleBase</span>.<span class="title function_">add</span>(<span class="title class_">GNameOffset</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">FNameEntryAllocator</span> = <span class="variable language_">this</span>.<span class="property">GName</span>.<span class="title function_">add</span>(<span class="number">0x30</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Blocks</span> = <span class="variable language_">this</span>.<span class="property">FNameEntryAllocator</span>.<span class="title function_">add</span>(<span class="number">0x10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GLevel</span> = <span class="variable language_">this</span>.<span class="property">GWorld</span>.<span class="title function_">add</span>(<span class="number">0x30</span>).<span class="title function_">readPointer</span>(); <span class="comment">//UWorld to Level</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Actors</span> = <span class="variable language_">this</span>.<span class="property">GLevel</span>.<span class="title function_">add</span>(<span class="number">0x98</span>).<span class="title function_">readPointer</span>(); <span class="comment">//ULevel -&gt; Actors</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ActorNum</span> = <span class="variable language_">this</span>.<span class="property">GLevel</span>.<span class="title function_">add</span>(<span class="number">0x98</span>).<span class="title function_">add</span>(<span class="number">0x8</span>).<span class="title function_">readU32</span>(); <span class="comment">//ULevel -&gt; Num</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getNameById</span>(<span class="params">ComparisonIndex</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">BlockId</span> = <span class="title class_">ComparisonIndex</span> &gt;&gt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Offset</span> = <span class="title class_">ComparisonIndex</span> &amp; <span class="number">65535</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> currentBlock = <span class="variable language_">this</span>.<span class="property">Blocks</span>.<span class="title function_">add</span>(<span class="number">8</span> * <span class="title class_">BlockId</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">FNameEntry</span> = currentBlock.<span class="title function_">add</span>(<span class="number">2</span> * <span class="title class_">Offset</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">FNameEntryHeader</span> = <span class="title class_">FNameEntry</span>.<span class="title function_">readU16</span>();</span><br><span class="line">        <span class="keyword">var</span> str_length = <span class="title class_">FNameEntryHeader</span> &gt;&gt; <span class="number">6</span>; <span class="comment">// 计算字符串长度</span></span><br><span class="line">        <span class="keyword">var</span> wide = <span class="title class_">FNameEntryHeader</span> &amp; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> str_addr = <span class="title class_">FNameEntry</span>.<span class="title function_">add</span>(<span class="number">0x2</span>);</span><br><span class="line">        <span class="keyword">if</span> (wide) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;wide_string&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (str_length &gt; <span class="number">0</span> &amp;&amp; str_length &lt; <span class="number">250</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> str = str_addr.<span class="title function_">readUtf8String</span>(str_length);</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">            <span class="number">0xadf07c0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;None&quot;</span>; <span class="comment">// 长度不合理，返回 &quot;None&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getActorByName</span>(<span class="params">actorName</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">ActorNum</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Actor</span> = <span class="variable language_">this</span>.<span class="property">Actors</span>.<span class="title function_">add</span>(i * <span class="number">8</span>).<span class="title function_">readPointer</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">ComparisonIndex</span> = <span class="title class_">Actor</span>.<span class="title function_">add</span>(<span class="number">0x18</span>).<span class="title function_">readU32</span>(); <span class="comment">//Actor -&gt; ComparisonIndex</span></span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Name</span> = <span class="variable language_">this</span>.<span class="title function_">getNameById</span>(<span class="title class_">ComparisonIndex</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">Name</span> == actorName) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;return Actor &quot;</span> + actorName);</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Actor</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;can&#x27;t find Actor:&quot;</span> + actorName);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;None&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getNameByActor</span>(<span class="params">actor</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">ComparisonIndex</span> = actor.<span class="title function_">add</span>(<span class="number">0x18</span>).<span class="title function_">readU32</span>(); <span class="comment">//Actor -&gt; ComparisonIndex</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Name</span> = <span class="variable language_">this</span>.<span class="title function_">getNameById</span>(<span class="title class_">ComparisonIndex</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">printAllActorName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">ActorNum</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Actor</span> = <span class="variable language_">this</span>.<span class="property">Actors</span>.<span class="title function_">add</span>(i * <span class="number">8</span>).<span class="title function_">readPointer</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">ComparisonIndex</span> = <span class="title class_">Actor</span>.<span class="title function_">add</span>(<span class="number">0x18</span>).<span class="title function_">readU32</span>(); <span class="comment">//Actor -&gt; ComparisonIndex</span></span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Name</span> = <span class="variable language_">this</span>.<span class="title function_">getNameById</span>(<span class="title class_">ComparisonIndex</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[!] actor <span class="subst">$&#123;i&#125;</span> Name: <span class="subst">$&#123;Name&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">forAllActor</span>(<span class="params">func</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">ActorNum</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Actor</span> = <span class="variable language_">this</span>.<span class="property">Actors</span>.<span class="title function_">add</span>(i * <span class="number">8</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">            <span class="title function_">func</span>(<span class="title class_">Actor</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setHP</span>(<span class="params">user, HP</span>) &#123;</span><br><span class="line">    user.<span class="title function_">add</span>(<span class="number">0x510</span>).<span class="title function_">writeFloat</span>(<span class="variable constant_">HP</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCharacterMovementComponent</span>(<span class="params">user</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> characterMovementComponent = user.<span class="title function_">add</span>(<span class="number">0x288</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">    <span class="keyword">return</span> characterMovementComponent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setActorLocation</span>(<span class="params">user, x, y, z</span>) &#123;</span><br><span class="line">    <span class="comment">// K2_SetActorLocation: 0x8C3181C</span></span><br><span class="line">    <span class="comment">// Actor -&gt; __int64 __fastcall K2_SetActorLocation(__int64 a1, char a2, __int64 a3, char a4, float32x2_t a5, float a6, float a7)</span></span><br><span class="line">    <span class="keyword">const</span> K2_SetActorLocationAddr = ue4Reverse.<span class="property">moduleBase</span>.<span class="title function_">add</span>(<span class="number">0x8c3181c</span>);</span><br><span class="line">    <span class="keyword">const</span> K2_SetActorLocation = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(</span><br><span class="line">        K2_SetActorLocationAddr,</span><br><span class="line">        <span class="string">&quot;void&quot;</span>,</span><br><span class="line">        [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;bool&quot;</span>, <span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;bool&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;float&quot;</span>]</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> buf = <span class="title class_">Memory</span>.<span class="title function_">alloc</span>(<span class="number">0x100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">K2_SetActorLocation</span>(user, <span class="number">1</span>, buf, <span class="number">1</span>, x, y, z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getActorLoaction</span>(<span class="params">user, log=<span class="literal">true</span></span>) &#123;</span><br><span class="line">    <span class="comment">//Actor -&gt;  Vector K2_GetActorLocation();// 0x965ddf8</span></span><br><span class="line">    <span class="keyword">const</span> getActorLoactionAddr = ue4Reverse.<span class="property">moduleBase</span>.<span class="title function_">add</span>(<span class="number">0x965ddf8</span>);</span><br><span class="line">    <span class="keyword">const</span> getActorLoaction = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(</span><br><span class="line">        getActorLoactionAddr,</span><br><span class="line">        <span class="string">&quot;pointer&quot;</span>,</span><br><span class="line">        [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;pointer&quot;</span>]</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> buf = <span class="title class_">Memory</span>.<span class="title function_">alloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    <span class="title function_">getActorLoaction</span>(user, buf, buf);</span><br><span class="line">    <span class="keyword">var</span> x = buf.<span class="title function_">readFloat</span>();</span><br><span class="line">    <span class="keyword">var</span> y = buf.<span class="title function_">add</span>(<span class="number">4</span>).<span class="title function_">readFloat</span>();</span><br><span class="line">    <span class="keyword">var</span> z = buf.<span class="title function_">add</span>(<span class="number">8</span>).<span class="title function_">readFloat</span>();</span><br><span class="line">    <span class="keyword">if</span>(log)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;x: &quot;</span> + x + <span class="string">&quot; y: &quot;</span> + y + <span class="string">&quot; z: &quot;</span> + z);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">x</span>: x, <span class="attr">y</span>: y, <span class="attr">z</span>: z &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SetVisibility</span>(<span class="params">actor</span>) &#123;</span><br><span class="line">    <span class="comment">//SceneComponent -&gt; void SetVisibility(bool bNewVisibility, bool bPropagateToChildren);// 0x9910794</span></span><br><span class="line">    <span class="keyword">const</span> setVisibilityAddr = ue4Reverse.<span class="property">moduleBase</span>.<span class="title function_">add</span>(<span class="number">0x8e619bc</span>);</span><br><span class="line">    <span class="keyword">const</span> setVisibility = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(setVisibilityAddr, <span class="string">&quot;void&quot;</span>, [</span><br><span class="line">        <span class="string">&quot;pointer&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bool&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bool&quot;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> rootComponent = actor.<span class="title function_">add</span>(<span class="number">0x130</span>).<span class="title function_">readPointer</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;rootComponent: &quot;</span> + rootComponent.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line">    <span class="keyword">if</span> (rootComponent != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title function_">setVisibility</span>(rootComponent, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setActorEnableCollision</span>(<span class="params">actor</span>) &#123;</span><br><span class="line">    <span class="comment">//Actor -&gt; void SetActorEnableCollision(bool bNewActorEnableCollision);</span></span><br><span class="line">    <span class="keyword">const</span> name = ue4Reverse.<span class="title function_">getNameByActor</span>(actor);</span><br><span class="line">    <span class="keyword">if</span>(!name.<span class="title function_">includes</span>(<span class="string">&quot;Cube&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> setActorEnableCollisionAddr = ue4Reverse.<span class="property">moduleBase</span>.<span class="title function_">add</span>(<span class="number">0x8c21320</span>);</span><br><span class="line">    <span class="keyword">const</span> setActorEnableCollision = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(setActorEnableCollisionAddr, <span class="string">&quot;void&quot;</span>, [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;bool&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setActorEnableCollision</span>(actor, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> rootComponent = actor.<span class="title function_">add</span>(<span class="number">0x130</span>).<span class="title function_">readPointer</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//PrimitiveComponent -&gt; void SetSimulatePhysics(bool bSimulate);// 0x98f0830</span></span><br><span class="line">    <span class="comment">// console.log(&quot;rootComponent: &quot; + rootComponent.toString(16))0</span></span><br><span class="line">    <span class="keyword">if</span> (rootComponent != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (rootComponent.<span class="title function_">readPointer</span>().<span class="title function_">add</span>(<span class="number">0x5d0</span>) != <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> setSimulatePhysicsAddr = rootComponent.<span class="title function_">readPointer</span>().<span class="title function_">add</span>(<span class="number">0x5d0</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">            <span class="keyword">var</span> setSimulatePhysics = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(setSimulatePhysicsAddr, <span class="string">&quot;void&quot;</span>, [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;bool&quot;</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setSimulatePhysics&quot;</span>);</span><br><span class="line">                <span class="title function_">setSimulatePhysics</span>(rootComponent, <span class="number">0</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;error: &quot;</span> + e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setCollisionEnabled</span>(<span class="params">actor</span>) &#123;</span><br><span class="line">    <span class="comment">//SceneComponent -&gt; void SetVisibility(bool bNewVisibility, bool bPropagateToChildren);// 0x9910794</span></span><br><span class="line">    <span class="keyword">const</span> name = ue4Reverse.<span class="title function_">getNameByActor</span>(actor);</span><br><span class="line">    <span class="keyword">if</span>(!name.<span class="title function_">includes</span>(<span class="string">&quot;Cube&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;name: &quot;</span> + name);</span><br><span class="line">    <span class="keyword">const</span> rootComponent = actor.<span class="title function_">add</span>(<span class="number">0x130</span>).<span class="title function_">readPointer</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;rootComponent: &quot;</span> + rootComponent.<span class="title function_">toString</span>(<span class="number">16</span>));</span><br><span class="line">    <span class="keyword">if</span> (rootComponent != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> setCollisionEnabledAddr = rootComponent</span><br><span class="line">            .<span class="title function_">readPointer</span>()</span><br><span class="line">            .<span class="title function_">add</span>(<span class="number">0x660</span>)</span><br><span class="line">            .<span class="title function_">readPointer</span>();</span><br><span class="line">        <span class="keyword">const</span> setCollisionEnabled = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(</span><br><span class="line">            setCollisionEnabledAddr,</span><br><span class="line">            <span class="string">&quot;void&quot;</span>,</span><br><span class="line">            [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;bool&quot;</span>]</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title function_">setCollisionEnabled</span>(rootComponent, <span class="number">3</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;error: &quot;</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printDistanceWithActor</span>(<span class="params">actor</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> location1 = <span class="title function_">getActorLoaction</span>(user, <span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">var</span> location2 = <span class="title function_">getActorLoaction</span>(actor,<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> actorName = ue4Reverse.<span class="title function_">getNameByActor</span>(actor)</span><br><span class="line">    <span class="keyword">var</span> distance = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(location1.<span class="property">x</span> - location2.<span class="property">x</span>, <span class="number">2</span>) + <span class="title class_">Math</span>.<span class="title function_">pow</span>(location1.<span class="property">y</span> - location2.<span class="property">y</span>, <span class="number">2</span>))</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`actorName: <span class="subst">$&#123;actorName&#125;</span>   distance: <span class="subst">$&#123;distance&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ue4Reverse = <span class="keyword">new</span> <span class="title class_">UE4Reverse</span>(<span class="number">0xb171cc0</span>, <span class="number">0xb32d8a8</span>);</span><br><span class="line"><span class="keyword">const</span> user = ue4Reverse.<span class="title function_">getActorByName</span>(<span class="string">&quot;FirstPersonCharacter_C&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">setHP</span>(user, <span class="number">1000000</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// setActorLocation(user, 292,-1613,9000)</span></span><br><span class="line"><span class="comment">// setActorLocation(user, -900, 1647, 9000)</span></span><br><span class="line"><span class="comment">// getActorLoaction(user)</span></span><br><span class="line"></span><br><span class="line">ue4Reverse.<span class="title function_">forAllActor</span>(<span class="title class_">SetVisibility</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ue4Reverse.forAllActor(setActorEnableCollision)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const triggerBox = ue4Reverse.getActorByName(&quot;TriggerBox&quot;)</span></span><br><span class="line"><span class="comment">// getActorLoaction(triggerBox)</span></span><br><span class="line"><span class="comment">// setActorLocation(user, -749, 109, 9000)</span></span><br><span class="line"></span><br><span class="line">ue4Reverse.<span class="title function_">forAllActor</span>(setCollisionEnabled);</span><br><span class="line"><span class="keyword">const</span> actor = ue4Reverse.<span class="title function_">getActorByName</span>(<span class="string">&quot;Actor&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="unidbg脚本"><a href="#unidbg脚本" class="headerlink" title="unidbg脚本"></a>unidbg脚本</h2><p>ACE2024.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ACE2024;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> capstone.Capstone;</span><br><span class="line"><span class="keyword">import</span> capstone.api.Instruction;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.backend.Backend;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.backend.CodeHook;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.backend.UnHook;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.DalvikModule;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.VM;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.virtualmodule.android.AndroidModule;</span><br><span class="line"><span class="keyword">import</span> keystone.Keystone;</span><br><span class="line"><span class="keyword">import</span> keystone.KeystoneArchitecture;</span><br><span class="line"><span class="keyword">import</span> keystone.KeystoneEncoded;</span><br><span class="line"><span class="keyword">import</span> keystone.KeystoneMode;</span><br><span class="line"><span class="keyword">import</span> unicorn.Arm64Const;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ACE2024</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Memory memory;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AsmContextQueue asmQueue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PatchInfoQueue patchQueue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Capstone capstone;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Keystone keystone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">inName</span> <span class="operator">=</span> <span class="string">&quot;C:\\Users\\Lenovo\\Desktop\\ACE2024\\lib2024\\arm64-v8a\\libplay.so&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">outName</span> <span class="operator">=</span> <span class="string">&quot;C:\\Users\\Lenovo\\Desktop\\ACE2024\\lib2024\\arm64-v8a\\libplayPatch.so&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ACE2024</span><span class="params">()</span> &#123;</span><br><span class="line">        emulator = AndroidEmulatorBuilder.for64Bit().build();</span><br><span class="line">        memory = emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        emulator.getSyscallHandler().setEnableThreadDispatcher(<span class="literal">true</span>);</span><br><span class="line">        vm = emulator.createDalvikVM();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">AndroidModule</span>(emulator,vm).register(memory);</span><br><span class="line">        <span class="type">DalvikModule</span> <span class="variable">dalvikModule</span> <span class="operator">=</span> vm.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;C:\\Users\\Lenovo\\Desktop\\ACE2024\\lib2024\\arm64-v8a\\libplay.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">module</span> = dalvikModule.getModule();</span><br><span class="line">        asmQueue = <span class="keyword">new</span> <span class="title class_">AsmContextQueue</span>();     <span class="comment">//用于缓存最近执行的10条指令</span></span><br><span class="line">        patchQueue = <span class="keyword">new</span> <span class="title class_">PatchInfoQueue</span>();        <span class="comment">//用于缓存patch队列</span></span><br><span class="line">        capstone = <span class="keyword">new</span> <span class="title class_">Capstone</span>(Capstone.CS_ARCH_ARM64,Capstone.CS_MODE_ARM);</span><br><span class="line">        keystone = <span class="keyword">new</span> <span class="title class_">Keystone</span>(KeystoneArchitecture.Arm64, KeystoneMode.LittleEndian);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">ACE2024</span> <span class="variable">mainActivity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ACE2024</span>();</span><br><span class="line">        mainActivity.debugger();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">debugger</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        emulator.traceCode(0x40000000,0x40010000);</span></span><br><span class="line">        deBR();</span><br><span class="line"><span class="comment">//        emulator.attach(DebuggerType.CONSOLE).addBreakPoint(module.base+ 0x000000001458);</span></span><br><span class="line">        <span class="keyword">module</span>.callFunction(emulator,<span class="number">0x0000000000001458</span> ,<span class="string">&quot;_Anti_Cheat_Expert&quot;</span>);</span><br><span class="line">        <span class="keyword">module</span>.callFunction(emulator,<span class="number">0x000000000000EEC</span> ,<span class="string">&quot;aaaa&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        doPatch();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deBR</span><span class="params">()</span>&#123;</span><br><span class="line">        emulator.getBackend().hook_add_new(<span class="keyword">new</span> <span class="title class_">CodeHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, Object user)</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="type">Capstone</span> <span class="variable">capstone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Capstone</span>(Capstone.CS_ARCH_ARM64,Capstone.CS_MODE_ARM);</span><br><span class="line">                <span class="type">byte</span>[] bytes = backend.mem_read(address, <span class="number">4</span>);</span><br><span class="line">                <span class="type">Instruction</span> <span class="variable">disasm</span> <span class="operator">=</span> capstone.disasm(bytes, address)[<span class="number">0</span>];</span><br><span class="line">                <span class="type">AsmContext</span> <span class="variable">asmContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AsmContext</span>();</span><br><span class="line">                asmContext.setAddress(address);</span><br><span class="line">                asmContext.setIns(disasm);</span><br><span class="line">                asmContext.setRegs(saveRegs(backend));</span><br><span class="line">                asmQueue.add(asmContext);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(disasm.getMnemonic().equals(<span class="string">&quot;br&quot;</span>))&#123;</span><br><span class="line">                    doProcessBR(backend, disasm);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="keyword">module</span>.base, <span class="keyword">module</span>.base + <span class="keyword">module</span>.size, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doProcessBR</span><span class="params">(Backend backend, Instruction disasm)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">brAddr</span> <span class="operator">=</span> disasm.getAddress() - <span class="keyword">module</span>.base;</span><br><span class="line">        <span class="type">long</span> <span class="variable">condBrAddr</span> <span class="operator">=</span> brAddr -<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">ldrAddr</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">brTargetAddr</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">condBrTargetAddr</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jcc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>();</span><br><span class="line">        <span class="type">AsmContext</span> <span class="variable">csetContext</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">AsmContext</span> <span class="variable">ldrContext</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历保存的指令，寻找cset和ldr</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; asmQueue.getSize() - <span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="type">AsmContext</span> <span class="variable">asmContext</span> <span class="operator">=</span> asmQueue.get(i);</span><br><span class="line">            <span class="type">Instruction</span> <span class="variable">ins</span> <span class="operator">=</span> asmContext.getIns();</span><br><span class="line">            <span class="type">String</span> <span class="variable">insMnemonic</span> <span class="operator">=</span> ins.getMnemonic();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(insMnemonic.equals(<span class="string">&quot;cset&quot;</span>))&#123;</span><br><span class="line">                csetContext = asmContext;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (insMnemonic.equals(<span class="string">&quot;ldr&quot;</span>))&#123;</span><br><span class="line">                <span class="comment">//可能会有多个ldr，这里只保留离br最近的ldr</span></span><br><span class="line">                ldrContext = asmContext;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(ldrContext == <span class="literal">null</span>)&#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;unrecognize br&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(csetContext != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 处理CSET</span></span><br><span class="line">            <span class="comment">// &quot;cset w10, lo&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// &quot;w10, lo&quot;</span></span><br><span class="line">            <span class="type">Instruction</span> <span class="variable">csetIns</span> <span class="operator">=</span> csetContext.getIns();</span><br><span class="line">            <span class="type">String</span> <span class="variable">opstr</span> <span class="operator">=</span> csetIns.getOpStr();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// &quot;lo&quot;</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">flag</span> <span class="operator">=</span> opstr.split(<span class="string">&quot;, &quot;</span>)[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// jcc = &quot;blo&quot;</span></span><br><span class="line">            jcc = <span class="string">&quot;b&quot;</span> + flag;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ldr x10, [x9, w10, uxtw #3]</span></span><br><span class="line">        <span class="comment">//ldr x17, [x16, #0xd48]</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Instruction</span> <span class="variable">ldrIns</span> <span class="operator">=</span> ldrContext.getIns();</span><br><span class="line">        ldrAddr = ldrIns.getAddress();</span><br><span class="line"></span><br><span class="line">        String[] opList = ldrIns.getOpStr().split(<span class="string">&quot;, &quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!jcc.isEmpty())&#123;</span><br><span class="line">            <span class="comment">//如果有cset，说明是条件跳转</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//移动ldr和br之间的内容</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">long</span> <span class="variable">addr</span> <span class="operator">=</span> ldrAddr; addr &lt; brAddr - <span class="number">4</span>; addr += <span class="number">4</span>)&#123;</span><br><span class="line">                <span class="type">byte</span>[] bytes = backend.mem_read(addr + <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">                <span class="type">Instruction</span> <span class="variable">patchAsm</span> <span class="operator">=</span> capstone.disasm(bytes, <span class="number">0</span>)[<span class="number">0</span>];</span><br><span class="line">                patchQueue.add(addr, patchAsm.getBytes());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">ldrBaseReg</span> <span class="operator">=</span> opList[<span class="number">1</span>].replace(<span class="string">&quot;[&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">ldrOffsetReg</span> <span class="operator">=</span> opList[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="type">Number</span> <span class="variable">tabelBaseAddr</span> <span class="operator">=</span> ldrContext.getReg(ldrBaseReg);</span><br><span class="line">            <span class="type">Number</span> <span class="variable">tabelOffsetAddr</span> <span class="operator">=</span> ldrContext.getReg(ldrOffsetReg);</span><br><span class="line"></span><br><span class="line">            condBrTargetAddr = readInt64(backend, tabelBaseAddr.longValue() + <span class="number">8</span>) - <span class="keyword">module</span>.base;</span><br><span class="line">            brTargetAddr = readInt64(backend, tabelBaseAddr.longValue()) - <span class="keyword">module</span>.base;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//br-4 改成条件跳转，br改成直接跳转</span></span><br><span class="line"></span><br><span class="line">            <span class="type">KeystoneEncoded</span> <span class="variable">condBr</span> <span class="operator">=</span> keystone.assemble(jcc+<span class="string">&quot; 0x&quot;</span>+ Integer.toHexString((<span class="type">int</span>)condBrTargetAddr).toString(), (<span class="type">int</span>)condBrAddr );</span><br><span class="line">            <span class="type">KeystoneEncoded</span> <span class="variable">br</span> <span class="operator">=</span> keystone.assemble(<span class="string">&quot;b 0x&quot;</span> + Integer.toHexString((<span class="type">int</span>)brTargetAddr), (<span class="type">int</span>) brAddr);</span><br><span class="line"></span><br><span class="line">            patchQueue.add(condBrAddr, condBr.getMachineCode());</span><br><span class="line">            patchQueue.add(brAddr, br.getMachineCode());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//没有cset，直接跳转</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// ldr x17, [x16, #0xd38] ,调用外部库函数，不做处理</span></span><br><span class="line">            <span class="keyword">if</span>(opList.length &lt; <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">ldrBaseReg</span> <span class="operator">=</span> opList[<span class="number">1</span>].replace(<span class="string">&quot;[&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">ldrOffsetReg</span> <span class="operator">=</span> opList[<span class="number">2</span>];</span><br><span class="line">            <span class="type">Number</span> <span class="variable">tabelBaseAddr</span> <span class="operator">=</span> ldrContext.getReg(ldrBaseReg);</span><br><span class="line">            <span class="type">Number</span> <span class="variable">tabelOffsetAddr</span> <span class="operator">=</span> ldrContext.getReg(ldrOffsetReg);</span><br><span class="line"></span><br><span class="line">            brTargetAddr = readInt64(backend, tabelBaseAddr.longValue() + tabelOffsetAddr.longValue() * <span class="number">8</span>) - <span class="keyword">module</span>.base;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将br改成直接跳转</span></span><br><span class="line">            <span class="type">KeystoneEncoded</span> <span class="variable">br</span> <span class="operator">=</span> keystone.assemble(<span class="string">&quot;b 0x&quot;</span> + Integer.toHexString((<span class="type">int</span>)brTargetAddr), (<span class="type">int</span>) brAddr);</span><br><span class="line">            patchQueue.add(brAddr, br.getMachineCode());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPatch</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(inName);</span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(f);</span><br><span class="line">            <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) f.length()];</span><br><span class="line">            fis.read(data);</span><br><span class="line">            fis.close();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; patchQueue.size(); i++)&#123;</span><br><span class="line">                <span class="type">PatchInfo</span> <span class="variable">pi</span> <span class="operator">=</span> patchQueue.get(i);</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    data[(<span class="type">int</span>) pi.address+j] = pi.ins[j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">File</span> <span class="variable">fo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(outName);</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(fo);</span><br><span class="line">            fos.write(data);</span><br><span class="line">            fos.flush();</span><br><span class="line">            fos.close();</span><br><span class="line">            System.out.println(<span class="string">&quot;finish&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Number&gt; <span class="title function_">saveRegs</span><span class="params">(Backend bk)</span> &#123;</span><br><span class="line">        List&lt;Number&gt; nb = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">29</span>;i++)</span><br><span class="line">        <span class="comment">//顺序存储x0到x28</span></span><br><span class="line">        &#123;</span><br><span class="line">            nb.add(bk.reg_read(i+ Arm64Const.UC_ARM64_REG_X0));</span><br><span class="line">        &#125;</span><br><span class="line">        nb.add(bk.reg_read(Arm64Const.UC_ARM64_REG_FP));</span><br><span class="line">        nb.add(bk.reg_read(Arm64Const.UC_ARM64_REG_LR));</span><br><span class="line">        <span class="keyword">return</span> nb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">readInt64</span><span class="params">(Backend bk,<span class="type">long</span> addr)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = bk.mem_read(addr, <span class="number">4</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;bytes.length;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            res =((bytes[i]&amp;<span class="number">0xffL</span>) &lt;&lt; (<span class="number">8</span>*i)) + res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>AsmContext.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ACE2024;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> capstone.api.Instruction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsmContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Number&gt; regs;</span><br><span class="line">    <span class="keyword">private</span> Instruction ins;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRegs</span><span class="params">(List&lt;Number&gt; regs)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.regs = regs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIns</span><span class="params">(Instruction ins)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.ins = ins;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(<span class="type">long</span> address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Number&gt; <span class="title function_">getRegs</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> regs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Instruction <span class="title function_">getIns</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ins;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Number <span class="title function_">getReg</span><span class="params">(String reg)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">offset</span> <span class="operator">=</span> (reg.replaceAll(<span class="string">&quot;[^0-9]&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> regs.get(Integer.parseInt(offset));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>AsmContextQueue.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ACE2024;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsmContextQueue</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_SIZE</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LinkedList&lt;AsmContext&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 线程安全的入队操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(AsmContext asmContext)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (queue.size() &gt;= MAX_SIZE) &#123;</span><br><span class="line">            queue.poll(); <span class="comment">// 移除最老的元素</span></span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(asmContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取指定位置的元素</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> AsmContext <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= queue.size() || index &gt;= MAX_SIZE) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// 返回空表示无效索引</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> queue.get(index); <span class="comment">// 使用 LinkedList 的 get 方法获取元素</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前队列快照</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> LinkedList&lt;AsmContext&gt; <span class="title function_">getInstructions</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(queue); <span class="comment">// 返回副本避免并发修改</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清空队列</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        queue.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前队列大小</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>PatchInfo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ACE2024;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatchInfo</span> &#123;</span><br><span class="line">    <span class="type">long</span> address;</span><br><span class="line">    <span class="type">byte</span>[] ins;</span><br><span class="line"></span><br><span class="line">    PatchInfo(<span class="type">long</span> address, <span class="type">byte</span>[] ins) &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">        <span class="built_in">this</span>.ins = ins;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>PatchQueue.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ACE2024;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatchInfoQueue</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;PatchInfo&gt; queue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PatchInfoQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.queue = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">long</span> address, <span class="type">byte</span>[] ins)</span> &#123;</span><br><span class="line">        <span class="comment">// Check if an entry with the same address already exists</span></span><br><span class="line">        <span class="keyword">for</span> (PatchInfo entry : queue) &#123;</span><br><span class="line">            <span class="keyword">if</span> (entry.address == address) &#123;</span><br><span class="line">                <span class="comment">// Replace the existing entry</span></span><br><span class="line">                entry.ins = ins;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Add a new entry if no matching address is found</span></span><br><span class="line">        queue.add(<span class="keyword">new</span> <span class="title class_">PatchInfo</span>(address, ins));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PatchInfo <span class="title function_">get</span><span class="params">(<span class="type">int</span> idx)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(idx &gt;= queue.size())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> queue.get(idx); <span class="comment">// Return null if no matching address is found</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(<span class="type">long</span> address)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue.removeIf(entry -&gt; entry.address == address);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (PatchInfo patchInfo : queue) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;address=&quot;</span> + patchInfo.address + <span class="string">&quot;, ins=&quot;</span> + patchInfo.ins);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="解密脚本-1"><a href="#解密脚本-1" class="headerlink" title="解密脚本"></a>解密脚本</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line"></span><br><span class="line"># 自定义base64解码</span><br><span class="line">custom_table = <span class="string">&#x27;ACE0BDFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz123456789+/&#x27;</span></span><br><span class="line">custom_dict = &#123;c: i <span class="keyword">for</span> i, c in enumerate(custom_table)&#125;</span><br><span class="line"></span><br><span class="line">def custom_b64decode(s):</span><br><span class="line">    # 处理填充字符</span><br><span class="line">    s += <span class="string">&#x27;=&#x27;</span> * ((<span class="number">4</span> - len(s) % <span class="number">4</span>) % <span class="number">4</span>)</span><br><span class="line">    binary_str = []</span><br><span class="line">    <span class="keyword">for</span> c in s:</span><br><span class="line">        <span class="keyword">if</span> c == <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            binary_str.append(<span class="string">&#x27;000000&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        binary_str.append(f<span class="string">&quot;&#123;custom_dict[c]:06b&#125;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    # 拼接二进制并转换为字节</span><br><span class="line">    bit_stream = <span class="string">&#x27;&#x27;.join(binary_str)</span></span><br><span class="line"><span class="string">    bytes_list = [int(bit_stream[i:i+8], 2) for i in range(0, len(bit_stream), 8) if i+8 &lt;= len(bit_stream)]</span></span><br><span class="line"><span class="string">    return bytes(bytes_list)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 异或解密</span></span><br><span class="line"><span class="string">def xor_decrypt(data, key):</span></span><br><span class="line"><span class="string">    key_len = len(key)</span></span><br><span class="line"><span class="string">    return bytes([data[i] ^ key[i % key_len] for i in range(len(data))])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &quot;__main__&quot;:</span></span><br><span class="line"><span class="string">    encoded_str = &quot;UT1fc0gIYDArdz80Z0Xem46J&quot;</span></span><br><span class="line"><span class="string">    result1 = custom_b64decode(encoded_str)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    key = bytes.fromhex(&quot;0A0C0E0051162738491A3B5C2D4E6FFAFCFE&quot;)</span></span><br><span class="line"><span class="string">    result2 = xor_decrypt(result1, key)</span></span><br><span class="line"><span class="string">    print(&quot;最终结果:&quot;, result2.decode(&quot;utf-8&quot;, errors=&quot;replace&quot;))</span></span><br></pre></td></tr></table></figure>





<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://renyili.org/post/game_cheat2/">https://renyili.org/post/game_cheat2/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1838396-1-1.html">https://www.52pojie.cn/thread-1838396-1-1.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/revercc/p/17641855.html">https://www.cnblogs.com/revercc/p/17641855.html</a></p>
<p><a target="_blank" rel="noopener" href="https://oacia.dev/unidbg-anti-br/">https://oacia.dev/unidbg-anti-br/</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Tinia</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/07/24/ACE2024/">http://example.com/2025/07/24/ACE2024/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">Tinia's Blog</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/07/24/testpic/" title="testpic"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">testpic</div></div><div class="info-2"><div class="info-item-1"> </div></div></div></a><a class="pagination-related" href="/2025/07/22/hello-world/" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Hello World</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;  More info: Writing Run server1$ hexo server  More info: Server Generate static files1$ hexo generate  More info: Generating Deploy to remote sites1$ hexo deploy  More info: Deployment </div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Tinia</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x0-%E9%80%86%E5%90%91%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">0x0 逆向前的准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#UE5%E6%96%87%E6%A1%A3%E9%80%9F%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">UE5文档速览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.2.</span> <span class="toc-text">对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Actor"><span class="toc-number">1.3.</span> <span class="toc-text">Actor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pawn"><span class="toc-number">1.4.</span> <span class="toc-text">Pawn</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%92%E8%89%B2"><span class="toc-number">1.5.</span> <span class="toc-text">角色</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%A9%E5%AE%B6%E7%8A%B6%E6%80%81"><span class="toc-number">1.6.</span> <span class="toc-text">玩家状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%93%E7%A7%AF"><span class="toc-number">1.7.</span> <span class="toc-text">体积</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%A9%E5%AE%B6%E5%87%BA%E7%94%9F%E7%82%B9"><span class="toc-number">1.7.1.</span> <span class="toc-text">玩家出生点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BB%E6%8C%A1%E4%BD%93%E7%A7%AF"><span class="toc-number">1.7.2.</span> <span class="toc-text">阻挡体积</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UE4%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.8.</span> <span class="toc-text">UE4内部实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x1-%E5%BC%80%E5%A7%8B%E9%80%86%E5%90%91"><span class="toc-number">2.</span> <span class="toc-text">0x1 开始逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GUObjectArray"><span class="toc-number">2.0.1.</span> <span class="toc-text">GUObjectArray</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GName"><span class="toc-number">2.0.2.</span> <span class="toc-text">GName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GWorld"><span class="toc-number">2.0.3.</span> <span class="toc-text">GWorld</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x2-%E8%A7%A3%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">0x2 解题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#section0"><span class="toc-number">3.0.1.</span> <span class="toc-text">section0</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9%E8%A1%80%E9%87%8F%EF%BC%9A"><span class="toc-number">3.0.1.1.</span> <span class="toc-text">改血量：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A3%E8%A1%80%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="toc-number">3.0.1.2.</span> <span class="toc-text">扣血函数：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#section1"><span class="toc-number">3.0.2.</span> <span class="toc-text">section1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#section2"><span class="toc-number">3.0.3.</span> <span class="toc-text">section2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#section3"><span class="toc-number">3.0.4.</span> <span class="toc-text">section3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%BB%E6%B7%B7%E6%B7%86%E6%80%9D%E8%B7%AF%EF%BC%9A"><span class="toc-number">3.0.4.1.</span> <span class="toc-text">去混淆思路：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-number">3.0.4.2.</span> <span class="toc-text">解密脚本</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC"><span class="toc-number">4.</span> <span class="toc-text">脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#frida%E8%84%9A%E6%9C%AC%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">frida脚本：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unidbg%E8%84%9A%E6%9C%AC"><span class="toc-number">4.2.</span> <span class="toc-text">unidbg脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC-1"><span class="toc-number">4.3.</span> <span class="toc-text">解密脚本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/24/ollvm%E5%AD%A6%E4%B9%A0/" title="使用ida脚本去除ollvm混淆">使用ida脚本去除ollvm混淆</a><time datetime="2025-07-24T12:23:49.894Z" title="发表于 2025-07-24 20:23:49">2025-07-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/24/testpic/" title="testpic">testpic</a><time datetime="2025-07-24T09:40:21.000Z" title="发表于 2025-07-24 17:40:21">2025-07-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/24/ACE2024/" title="小白写给小白的wp-腾讯游戏安全竞赛2024安卓">小白写给小白的wp-腾讯游戏安全竞赛2024安卓</a><time datetime="2025-07-24T08:03:17.347Z" title="发表于 2025-07-24 16:03:17">2025-07-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/22/hello-world/" title="Hello World">Hello World</a><time datetime="2025-07-22T13:43:44.755Z" title="发表于 2025-07-22 21:43:44">2025-07-22</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By Tinia</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>